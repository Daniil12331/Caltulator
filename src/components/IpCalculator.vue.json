<!-- src/components/IpCalculator.vue -->
<template>
  <div class="ip-calculator">
    <h2 class="ip-calculator__title">IP Subnet Calculator</h2>

    <div class="ip-calculator__form">
      <input
        v-model="ipInput"
        @keyup.enter="handleSubmit"
        type="text"
        class="ip-calculator__input"
        placeholder="Например: 192.168.1.150"
        :disabled="loading"
      />

      <select
        v-model="selectedMask"
        class="ip-calculator__select"
        :disabled="loading"
      >
        <option value="" disabled>Выберите маску подсети</option>
        <option
          v-for="mask in subnetMasks"
          :key="mask.value"
          :value="mask.value"
        >
          {{ mask.label }}
        </option>
      </select>

      <button
        class="ip-calculator__button"
        :disabled="!isValid || !selectedMask || loading"
        @click="handleSubmit"
      >
        Рассчитать
      </button>
    </div>

    <div v-if="result" class="ip-calculator__result">
      <p><strong>IP адрес:</strong> {{ ipInput }}</p>
      <p><strong>Маска подсети:</strong> {{ selectedMask }}</p>
      <p><strong>Адрес сети:</strong> {{ result.network }}</p>
      <p><strong>Доступных адресов:</strong> {{ result.hosts }}</p>
    </div>

    <div v-else-if="!isValid && ipInput" class="ip-calculator__error">
      Некорректный IP-адрес
    </div>
  </div>
</template>

<script setup>
import { ref, computed, watch } from 'vue';
import { SUBNET_MASKS } from '@/constants/subnetMasks.js';
import { isIpValid, getNetworkAddress, getAddressesCount } from '@/utils/ipUtils.js';

const ipInput = ref('');
const selectedMask = ref('');
const loading = ref(false);
const result = ref(null);

const subnetMasks = SUBNET_MASKS;

const isValid = computed(() => isIpValid(ipInput.value));

// Сброс результата при изменении полей
watch([ipInput, selectedMask], () => {
  result.value = null;
});

function handleSubmit() {
  if (!isValid.value || !selectedMask.value) return;

  loading.value = true;
  // Имитация асинхронности (можно убрать)
  setTimeout(() => {
    const network = getNetworkAddress(ipInput.value, selectedMask.value);
    const hosts = getAddressesCount(selectedMask.value);
    result.value = { network, hosts };
    loading.value = false;
  }, 100);
}
</script>

<style scoped>
.ip-calculator {
  max-width: 500px;
  margin: 0 auto;
  padding: 1.5rem;
  background: var(--card-bg);
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.ip-calculator__title {
  text-align: center;
  color: var(--text-primary);
  margin-bottom: 1.5rem;
  font-size: 1.5rem;
}

.ip-calculator__form {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.ip-calculator__input,
.ip-calculator__select {
  padding: 0.75rem;
  border: 1px solid var(--border-color);
  border-radius: 8px;
  font-size: 1rem;
  background: var(--input-bg);
  color: var(--text-primary);
}

.ip-calculator__input:focus,
.ip-calculator__select:focus {
  outline: none;
  border-color: var(--primary-color);
}

.ip-calculator__button {
  padding: 0.75rem;
  background: var(--primary-color);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 1rem;
  cursor: pointer;
  transition: background 0.2s;
}

.ip-calculator__button:disabled {
  background: var(--disabled-bg);
  cursor: not-allowed;
}

.ip-calculator__result {
  margin-top: 1.5rem;
  padding: 1rem;
  background: var(--success-bg);
  border-radius: 8px;
  color: var(--success-text);
}

.ip-calculator__error {
  margin-top: 1rem;
  padding: 0.75rem;
  background: var(--error-bg);
  color: var(--error-text);
  border-radius: 8px;
  text-align: center;
}
</style>